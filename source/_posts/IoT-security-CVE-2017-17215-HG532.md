---
title: 'IoT security: CVE-2017-17215(HG532)'
date: 2018-03-08 22:18:27
tags:
- IoT security
- 2018
---

This is a post about CVE-2017-17215 in Huawei HG532 home routers. The Satori botnet is actually using this CVE to build an IoT bot net.

A post I recommend reading before this one.
https://research.checkpoint.com/good-zero-day-skiddie/

To be honest, this exploitation is very easy. HG532 is using UPnP protocol on port 37215. This service is for firmware upgrade. We can simply send a request to <b><i>“/strlt/DeviceUpgrade_1”</i></b> and the two elements should be ‘NewStatusURL’ and ‘NewDownloadURL’. So if we replace these two elements with the commands that we want to execute, we can have remote execution.
 
{% asset_img 1.PNG %} 

This is the PoC in the exploit-db. We can see it just changes the <NewStatusURL> element. So let’s check the mips assembly code here for upnp file.
 
{% asset_img 2.PNG %} 

The key function here should be the <b><i>snprintf</i></b> and <b><i>system</i></b>.
For the <b><i>snprintf</i></b>, we know it has the format like <b><i>“int snprintf ( char * s, size_t n, const char * format, ... );”</i></b>.

{% asset_img 3.PNG %} 

So here, a0 stores the final string, a1 stores the length of the buffer, a2 stores the actual string that we input. 

So we can see it executes <b><i>system(a0)</i></b> later. In this case, we control the a2 so if we input something like <b><i>***; ls ;</i></b> we will finally execute <b><i>‘ls’</i></b> on the router.

Any question, please contact me at <b><i>xudong_shao@hotmail.com</i></b>.

