---
title: 'Malware analysis: Dridex and process hollowing'
date: 2017-12-20 12:41:24
tags:
- 2017
- Malware analysis
- Windows malware
---

Well, to be honest, I didn’t make a lot progress on this malware and all those decoding process seems very complicated to me. But yeah, I will write down what I did and anyone who is looking this post should know that there is a better analysis here by MalwareAnalysisForHedgehogs. And they also provide a link to a good post to analysis this malware.

{% youtube aBKk2KAN0E0 %}

Basically, process hollowing create a new legitimate process and replace that process with malicious code. So the code may run as if it is legitimate. The key API should be <b><i>“CreateProcesS”</i></b>, <b><i>“WriteProcessMemory”</i></b>. What makes me confusing is here, the Dridex starts a child process and uses process hollowing to replace the content of that child process. I simply think this doesn’t make sense. Well, trevlix from this post <a href="https://www.reddit.com/r/Malware/comments/7kub4k/one_problem_i_faced_in_a_malware_can_anyone_help/">here</a> told me that in this malware it probably use this to unpack itself. Probably he is right.

MalwareAnalysisForHedgehogs used APImonitor to set the breakpoint but I used Olldbg and it turns out that the blog they provide used Ollybdg too.

At first in Ollydbg, you need to set a breakpoint on <b><i>WriteProcessMemory</i></b> with <b><i>“bp WriteProcessMemory”</i></b>. Then you run it.

{% asset_img 1.png %}

You can check that buffer address here. You will see the start of a PE file. Then you have two choice. I used HxD tp attach to the process and go to the address <b><i>0x460000</i></b> then copied those thing into a new file. You can also just right click in the Ollydbg and save all those binary data. These will leads to the same file which is like this.
 
{% asset_img 2.PNG %}

Use the compare button in HxD we can verify that the files we get from two methods are the same.

Ok, this is all I have. Probably I will try to analyze this malware in details when I learn more.

Any questions, contact me at <b><i>xudong_shao@hotmail</i></b>.

